(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{938:(e,t,a)=>{Promise.resolve().then(a.bind(a,4976))},4976:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eC,dynamic:()=>ew});var s=a(5155),i=a(2115),n=a(7916),r=a(2870),l=a(4317),o=a(5037),c=a(7078),d=a(4511),u=a(3562);function x(e){let{rating:t,onChange:a,disabled:n}=e,[r,l]=(0,i.useState)(null);return(0,s.jsx)("div",{className:"flex gap-1",children:[1,2,3,4,5].map(e=>(0,s.jsx)(u.P.button,{disabled:n,onClick:()=>a(e),onMouseEnter:()=>l(e),onMouseLeave:()=>l(null),whileHover:{scale:1.1},whileTap:{scale:.9},className:"text-2xl ".concat(n?"cursor-not-allowed":"cursor-pointer"),children:(0,s.jsx)("span",{className:"\n            transition-colors\n            ".concat((null!==r?e<=r:e<=t)?"text-yellow-400":"text-gray-600","\n          "),children:"★"})},e))})}var m=a(9827);let g=(0,m.v)((e,t)=>({items:[],isLoading:!1,error:null,setItems:t=>e({items:t}),addItems:t=>e(e=>({items:[...e.items,...t]})),updateItem:(t,a)=>e(e=>({items:e.items.map(e=>{if(e.id===t){var s;let t=(null===(s=a.data)||void 0===s?void 0:s.quantity)?{...a.data,quantity:p(a.data.quantity)}:a.data;return{...e,data:{...e.data,...t},nutrition:{...e.nutrition,...a.nutrition}}}return e})})),deleteItem:async a=>{let s=t().items;e(e=>({items:e.items.filter(e=>e.id!==a)}));try{await c.dt.deleteItem(a)}catch(t){throw e({items:s,error:"Failed to delete item"}),t}},fetchItems:async()=>{e({isLoading:!0,error:null});try{let t=await c.dt.getItems();e({items:t,isLoading:!1})}catch(t){e({error:"Failed to fetch items",isLoading:!1})}},clearError:()=>e({error:null}),reset:()=>e({items:[],isLoading:!1,error:null})})),p=e=>Math.round(100*e)/100,h=(0,m.v)((e,t)=>({recipes:[],preferences:{cuisine:[],max_prep_time:void 0,dietary:[],serving_size:2,meal_types:[],nutrition_goals:[],custom_preferences:"",recipes_per_meal:4,max_calories:void 0,min_protein:void 0},isLoading:!1,isGenerating:!1,error:null,lastFetched:null,setRecipes:t=>e(e=>({recipes:"function"==typeof t?t(e.recipes):t})),setPreferences:t=>e(e=>({preferences:{...e.preferences,...t}})),setIsLoading:t=>e({isLoading:t}),setIsGenerating:t=>e({isGenerating:t}),setError:t=>e({error:t}),clearRecipes:()=>e({recipes:[]}),fetchRecipes:async()=>{let a=t();if(a.isLoading)return;let s=Date.now();if(!a.lastFetched||!(s-a.lastFetched<3e5))try{e({isLoading:!0,error:null});let t=await c.Hv.getAll();e({recipes:t,lastFetched:s,error:null})}catch(t){e({error:t instanceof Error?t.message:"Failed to load recipes"}),console.error("Recipe fetch error:",t)}finally{e({isLoading:!1})}},useRecipe:async(e,t,a)=>{try{await c.Hv.use(e,{servings_made:t,ingredients_used:a}),await g.getState().fetchItems()}catch(e){throw console.error("Error using recipe:",e),e}}})),y=(e,t)=>{let a=e.data.ingredients.length;if(0===a)return{percentage:0,available:0,total:a};let s=e.data.ingredients.filter(e=>void 0!==t.find(t=>t.data.name&&t.data.name.toLowerCase()===e.name.toLowerCase())).length;return{percentage:Math.round(s/a*100),available:s,total:a}};function b(e){let{recipe:t,onClose:a,onUse:n,onRemove:r,pantryItems:m}=e,[g,p]=(0,i.useState)(!1),[h,b]=(0,i.useState)(!1),[j,f]=(0,i.useState)(0),[v,N]=(0,i.useState)(""),[w,C]=(0,i.useState)(!1),[k,S]=(0,i.useState)(!0),[I,E]=(0,i.useState)(!0),[A,P]=(0,i.useState)(!1),[D,R]=(0,i.useState)([]),[_,T]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=await c.Hv.getInteractions(t.id);R(e);let a=e.find(e=>"save"===e.type),s=e.find(e=>"rate"===e.type);a&&P(!0),s&&F(s.data)&&(f(s.rating||0),N(s.data.review||""))}catch(e){console.error("Error fetching recipe interactions:",e)}})()},[t.id]);let F=e=>"rating"in e,L=e=>m.find(t=>t.data.name&&t.data.name.toLowerCase()===e.name.toLowerCase())?"text-green-400":e.substitutes&&e.substitutes.length>0?"text-yellow-400":"text-red-400",z=async()=>{try{p(!0),await c.Hv.saveRecipe(t.id),P(!0),(0,d.u4)("save_recipe",{recipeName:t.data.name,ingredientCount:t.data.ingredients.length}),o.oR.success("Recipe saved to cookbook")}catch(e){console.error("Error saving recipe:",e),e instanceof Error&&e.message.includes("duplicate key value")?(P(!0),o.oR.success("Recipe already in cookbook")):o.oR.error("Failed to save recipe")}finally{p(!1)}},q=async()=>{if(0===j){o.oR.error("Please select a rating");return}try{b(!0),await c.Hv.rateRecipe(t.id,j,v),(0,d.u4)("rate_recipe",{recipeName:t.data.name,rating:j,hasReview:!!v}),o.oR.success("Rating saved"),C(!1)}catch(e){console.error("Error rating recipe:",e),o.oR.error("Failed to save rating")}finally{b(!1)}};return(0,s.jsxs)(l.lG,{open:!0,onClose:a,className:"relative z-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsxs)(l.lG.Panel,{className:"w-full max-w-3xl rounded-xl bg-gray-900 p-8 shadow-xl",children:[(0,s.jsx)("div",{className:"space-y-4 mb-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.lG.Title,{className:"text-2xl font-bold text-white",children:t.data.name}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsxs)("span",{className:"px-3 py-1 bg-gray-800 rounded-full text-gray-300",children:["⏱️ ",t.data.preparation_time," mins"]}),(0,s.jsx)("span",{className:"px-3 py-1 bg-gray-800 rounded-full text-gray-300 capitalize",children:t.data.category})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsx)("button",{onClick:()=>C(!0),className:"flex items-center gap-1 text-gray-400 hover:text-yellow-400",children:[1,2,3,4,5].map(e=>(0,s.jsx)("span",{className:e<=j?"text-yellow-400":"text-gray-400",children:e<=j?"★":"☆"},e))}),(0,s.jsx)("button",{onClick:z,disabled:g,className:"flex items-center gap-1 disabled:opacity-50 ".concat(A?"text-red-400":"text-gray-400 hover:text-red-400"),children:g?"...":A?"❤️":"♡"}),(0,s.jsxs)("span",{className:y(t,m).percentage>=75?"text-green-400":y(t,m).percentage>=50?"text-yellow-400":"text-red-400",children:[y(t,m).percentage,"%"]}),t.data.price&&(0,s.jsxs)("span",{className:"text-gray-400",children:["$",t.data.price.toFixed(2)]})]})]})]}),(0,s.jsx)("button",{onClick:a,className:"p-3 -mr-2 text-gray-400 hover:text-white sm:p-0","aria-label":"Close modal",children:(0,s.jsx)("span",{className:"text-xl sm:text-base",children:"✕"})})]})}),w&&(0,s.jsxs)(u.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-3 bg-gray-800/50 p-6 rounded-lg mb-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{rating:j,onChange:f,disabled:h}),(0,s.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),disabled:h,className:"w-full bg-gray-800 rounded-lg px-3 py-2 text-white min-h-[80px]",placeholder:"Share your thoughts about this recipe..."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:()=>C(!1),className:"px-4 py-2 text-sm text-gray-400 hover:text-white",children:"Cancel"}),(0,s.jsx)("button",{onClick:q,disabled:h||0===j,className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50",children:h?"Saving...":"Save Rating"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{onClick:()=>S(!k),className:"w-full flex justify-between items-center p-3 -mx-3 hover:bg-gray-800/50 rounded-lg transition-colors",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-200",children:"Ingredients"}),(0,s.jsx)("span",{className:"text-gray-400",children:k?"−":"+"})]}),(0,s.jsx)("div",{className:"\n                  overflow-hidden transition-all duration-300 ease-in-out\n                  ".concat(k?"max-h-[500px] opacity-100 mt-4":"max-h-0 opacity-0 mt-0","\n                "),children:(0,s.jsx)("ul",{className:"space-y-2",children:t.data.ingredients.map((e,t)=>(0,s.jsxs)("li",{className:"text-sm ".concat(L(e)),children:[e.quantity," ",e.unit," ",e.name,e.substitutes&&e.substitutes.length>0&&(0,s.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Substitutes: ",e.substitutes.join(", ")]}),(e.calories||e.protein||e.carbs||e.fat||e.fiber)&&(0,s.jsxs)("div",{className:"text-xs text-gray-400 mt-1 flex flex-wrap gap-2",children:[e.calories&&(0,s.jsxs)("span",{children:["\uD83D\uDD25 ",e.calories," cal"]}),e.protein&&(0,s.jsxs)("span",{children:["\uD83D\uDCAA ",e.protein,"g protein"]}),e.carbs&&(0,s.jsxs)("span",{children:["\uD83C\uDF5A ",e.carbs,"g carbs"]}),e.fat&&(0,s.jsxs)("span",{children:["\uD83E\uDD51 ",e.fat,"g fat"]}),e.fiber&&(0,s.jsxs)("span",{children:["\uD83C\uDF3E ",e.fiber,"g fiber"]})]})]},t))})})]}),(0,s.jsx)("div",{className:"border-t border-gray-800"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{onClick:()=>E(!I),className:"w-full flex justify-between items-center p-3 -mx-3 hover:bg-gray-800/50 rounded-lg transition-colors",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-200",children:"Instructions"}),(0,s.jsx)("span",{className:"text-gray-400",children:I?"−":"+"})]}),(0,s.jsx)("div",{className:"\n                  overflow-hidden transition-all duration-300 ease-in-out\n                  ".concat(I?"max-h-[1000px] opacity-100 mt-4":"max-h-0 opacity-0 mt-0","\n                "),children:(0,s.jsx)("ol",{className:"space-y-2",children:t.data.instructions.map((e,t)=>(0,s.jsxs)("li",{className:"text-sm text-gray-300",children:[t+1,". ",e]},t))})})]}),(0,s.jsx)("div",{className:"border-t border-gray-800"}),t.data.nutrition&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{onClick:()=>T(!_),className:"w-full flex justify-between items-center p-3 -mx-3 hover:bg-gray-800/50 rounded-lg transition-colors",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-200",children:"Nutrition (per serving)"}),(0,s.jsx)("span",{className:"text-gray-400",children:_?"−":"+"})]}),(0,s.jsx)("div",{className:"\n                    overflow-hidden transition-all duration-300 ease-in-out\n                    ".concat(_?"max-h-[500px] opacity-100 mt-4":"max-h-0 opacity-0 mt-0","\n                  "),children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-gray-300",children:[t.data.nutrition.calories&&(0,s.jsxs)("p",{children:["Calories: ",t.data.nutrition.calories," kcal"]}),t.data.nutrition.protein&&(0,s.jsxs)("p",{children:["Protein: ",t.data.nutrition.protein,"g"]}),t.data.nutrition.carbs&&(0,s.jsxs)("p",{children:["Carbs: ",t.data.nutrition.carbs,"g"]}),t.data.nutrition.fat&&(0,s.jsxs)("p",{children:["Fat: ",t.data.nutrition.fat,"g"]}),t.data.nutrition.fiber&&(0,s.jsxs)("p",{children:["Fiber: ",t.data.nutrition.fiber,"g"]})]})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm text-red-400 hover:text-red-300",children:"Remove Recipe"}),(0,s.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Use Recipe"})]})]})})})]})}let j=()=>{let[e,t]=(0,i.useState)(null);return{error:e,setError:t,handleError:e=>{t(e instanceof Error?e.message:"An unexpected error occurred"),console.error("Error:",e)},clearError:()=>t(null)}};function f(e){let{ingredients:t,pantryItems:a}=e;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-gray-300 font-medium",children:"Required Ingredients:"}),(0,s.jsx)("ul",{className:"space-y-2",children:t.map((e,t)=>{let i=a.find(t=>t.data.name&&t.data.name.toLowerCase()===e.name.toLowerCase()&&t.data.unit===e.unit&&t.data.quantity>=e.quantity);return(0,s.jsxs)("li",{className:"text-sm ".concat(i?"text-green-400":"text-yellow-500"),children:[e.quantity," ",e.unit," ",e.name,i&&(0,s.jsxs)("span",{className:"text-gray-400 text-xs ml-2",children:["(Available: ",i.data.quantity," ",i.data.unit,")"]})]},t)})})]})}function v(e){let{recipe:t,pantryItems:a,servings:i,onServingsChange:n,onContinue:r,onClose:l}=e,o=t.data.ingredients.map(e=>({...e,quantity:e.quantity/t.data.servings*i}));return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("label",{className:"text-gray-300",children:"Servings:"}),(0,s.jsx)("input",{type:"number",min:"1",value:i,onChange:e=>n(Math.max(1,parseInt(e.target.value)||1)),className:"bg-gray-800 rounded px-3 py-2 text-white"})]}),(0,s.jsx)(f,{ingredients:o,pantryItems:a}),(0,s.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,s.jsx)("button",{onClick:l,className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Continue"})]})]})}function N(e){var t;let{id:a,item:i,recipe:n,onEdit:r}=e,l=i.matches?i.data.unit:i.data.name&&(null===(t=n.data.ingredients.find(e=>e.name.toLowerCase()===i.data.name.toLowerCase()))||void 0===t?void 0:t.unit);return(0,s.jsxs)("div",{className:"p-4 rounded-lg cursor-pointer ".concat(i.matches?0===i.final?"bg-red-500/20":"bg-gray-800":"bg-yellow-500/20"," hover:bg-opacity-80 transition-colors"),onClick:()=>{r({id:a,item:{data:{...i.data,quantity:i.initial},nutrition:i.nutrition}})},children:[(0,s.jsx)("div",{className:"font-medium text-white",children:i.data.name}),(0,s.jsxs)("div",{className:"text-sm mt-1 space-y-1",children:[i.data.category&&(0,s.jsxs)("div",{className:"text-gray-400",children:["Category: ",i.data.category]}),(0,s.jsxs)("div",{className:"text-gray-400",children:["Current: ",i.initial.toFixed(2)," ",i.data.unit]}),!i.matches&&l&&(0,s.jsxs)("div",{className:"text-yellow-400",children:["Recipe requires: ",l,(0,s.jsx)("br",{}),"Current unit: ",i.data.unit]}),i.matches?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-gray-400",children:["Using: ",(i.initial-i.final).toFixed(2)," ",i.data.unit]}),(0,s.jsxs)("div",{className:"".concat(0===i.final?"text-red-400":"text-green-400"),children:["Remaining: ",i.final.toFixed(2)," ",i.data.unit,0===i.final&&" (Will be removed)"]})]}):(0,s.jsx)("div",{className:"text-yellow-400",children:"Units don't match recipe requirements. Click to edit."}),i.data.notes&&(0,s.jsxs)("div",{className:"text-gray-400 italic",children:["Note: ",i.data.notes]})]})]})}function w(e){let{finalQuantities:t,onBack:a,onConfirm:i,isConfirming:n,onEditItem:r,recipe:l}=e;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("p",{className:"text-gray-300",children:"The following changes will be made to your pantry:"}),(0,s.jsx)("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:Array.from(t.entries()).map(e=>{let[t,a]=e;return(0,s.jsx)(N,{id:t,item:a,recipe:l,onEdit:e=>r({...e,item:{...e.item,id:"",user_id:"",created_at:"",updated_at:""}})},t)})}),(0,s.jsxs)("div",{className:"flex justify-end gap-4 mt-4",children:[(0,s.jsx)("button",{onClick:a,className:"px-4 py-2 text-gray-400 hover:text-white",children:"Back"}),(0,s.jsx)("button",{onClick:i,disabled:n,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",children:n?"Confirming...":"Confirm Use"})]})]})}function C(e){let{label:t,error:a,className:i="",...n}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:t}),(0,s.jsx)("input",{...n,className:"w-full bg-gray-700 rounded-lg px-3 py-2 focus:ring-2 ring-blue-500 focus:outline-none ".concat(a?"border-red-500":"border-gray-600"," ").concat(i)}),a&&(0,s.jsx)("span",{className:"text-red-400 text-sm mt-1",children:a})]})}let k={data:{name:"",original_name:"",quantity:1,unit:"units",category:"Pantry",notes:"",expiry_date:null,price:null},nutrition:{standard_unit:"100 grams"}},S=["units","grams","milliliters","pieces","cups","tablespoons","teaspoons","ounces","pounds","pinch"];function I(e){var t,a,n,r,o,c,d,x,m;let{initialValues:g,onAdd:p,onClose:h,isEditing:y,isRecipeUse:b,originalQuantity:j}=e,{values:f,handleChange:v,handleSubmit:N,isSubmitting:w,errors:I}=function(e){let{initialValues:t,onSubmit:a,onClose:s}=e,[n,r]=(0,i.useState)(t||k),[l,o]=(0,i.useState)({}),[c,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&r(t)},[t]);let u=()=>{let e={};return n.data.name.trim()||(e.name="Name is required"),n.data.unit.trim()||(e.unit="Unit is required"),n.data.quantity<=0&&(e.quantity="Quantity must be greater than 0"),o(e),0===Object.keys(e).length},x=async e=>{if(e.preventDefault(),d(!0),!u()){d(!1);return}try{let e={...n,data:{...n.data,expiry_date:n.data.expiry_date?new Date(n.data.expiry_date).toISOString().split("T")[0]:null}};await a(e),s()}catch(e){o({form:e instanceof Error?e.message:"Failed to add item. Please try again."})}finally{d(!1)}};return{values:n,handleChange:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"data";r(s=>({...s,[a]:{...s[a],[e]:"expiry_date"===e&&t?new Date(t).toISOString():""===t&&"name"!==e&&"unit"!==e&&"notes"!==e?null:t}}))},handleSubmit:x,isSubmitting:c,errors:l}}({initialValues:g,onSubmit:async e=>{e.data.category||(e.data.category="Pantry Staples"),e.data.unit||(e.data.unit="units"),await Promise.resolve(p(e))},onClose:h}),[E,A]=(0,i.useState)(!1),[P,D]=(0,i.useState)(!1),[R,_]=(0,i.useState)(!1);return(0,s.jsxs)(l.lG,{open:!0,onClose:h,className:"relative z-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsx)(u.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{type:"spring",duration:.3},children:(0,s.jsxs)(l.lG.Panel,{className:"w-full max-w-xl rounded-xl bg-gray-900 p-6",children:[(0,s.jsxs)(u.P.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},children:[(0,s.jsx)(l.lG.Title,{className:"text-2xl font-bold text-white mb-4",children:y?"Edit Item":"Add Item"}),b&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-blue-500/20 rounded-lg text-blue-300 text-sm",children:[(0,s.jsx)("p",{children:"You are editing this item during recipe use. The quantity you set will be the final amount remaining in your pantry after using the recipe."}),void 0!==j&&(0,s.jsxs)("p",{className:"mt-2",children:["Original quantity: ",j," ",f.data.unit]})]})]}),(0,s.jsxs)("form",{onSubmit:N,children:[(0,s.jsx)(u.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2},children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(C,{label:"Name",value:f.data.name,onChange:e=>v("name",e.target.value),error:I.name,required:!0,placeholder:"Common name (e.g., bread)",className:"w-full bg-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-1 ring-blue-500 focus:outline-none"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(C,{label:b?"Final Pantry Quantity":"Quantity",type:"number",value:w?"":null!==(n=f.data.quantity)&&void 0!==n?n:"",onChange:e=>{let t=e.target.value;v("quantity",""===t?null:Number(t))},disabled:w,error:I.quantity,placeholder:"Enter quantity",className:"w-full bg-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-1 ring-blue-500 focus:outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Unit"}),(0,s.jsx)("input",{type:"text",value:f.data.unit,onChange:e=>v("unit",e.target.value),className:"w-full bg-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-1 ring-blue-500 focus:outline-none",placeholder:"units",onFocus:()=>v("unit",""),list:"unit-suggestions",autoComplete:"off"}),(0,s.jsx)("datalist",{id:"unit-suggestions",children:S.map(e=>(0,s.jsx)("option",{value:e},e))})]})]})]})}),(0,s.jsx)(u.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3},children:(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>A(!E),className:"text-blue-400 hover:text-blue-300 mb-3",children:E?"Hide Additional Info":"Additional Info"}),E&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Category"}),(0,s.jsx)("input",{list:"category-suggestions",type:"text",value:f.data.category,onChange:e=>v("category",e.target.value),className:"w-full bg-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 ring-blue-500 focus:outline-none",placeholder:"Select or enter category"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Expiry Date"}),(0,s.jsx)("input",{type:"date",value:f.data.expiry_date?new Date(f.data.expiry_date).toISOString().split("T")[0]:"",onChange:e=>v("expiry_date",e.target.value||null),className:"w-full bg-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 ring-blue-500 focus:outline-none"})]}),(0,s.jsx)(C,{label:"Price",error:I.price,type:"number",value:null!==(r=null===(t=f.data.price)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",onChange:e=>v("price",e.target.value?Number(e.target.value):null),min:"0",step:"0.01",placeholder:"Enter price (optional)"}),(0,s.jsx)(C,{label:"Original Name",value:f.data.original_name||"",onChange:e=>v("original_name",e.target.value),error:I.original_name,placeholder:"As scanned/entered (optional)"})]})]})}),(0,s.jsx)(u.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.4},children:(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>D(!P),className:"text-blue-400 hover:text-blue-300 mb-3",children:P?"Hide Nutrition":"Nutrition"}),P&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Note: Nutrition information will be automatically enriched if left empty"}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["All values below are per ",(null==f?void 0:null===(a=f.nutrition)||void 0===a?void 0:a.standard_unit)||"100 grams"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(C,{label:"Calories",type:"number",value:null!==(o=f.nutrition.calories)&&void 0!==o?o:"",onChange:e=>v("calories",e.target.value?Number(e.target.value):0,"nutrition"),min:"0",step:"1"}),(0,s.jsx)(C,{label:"Protein",type:"number",value:null!==(c=f.nutrition.protein)&&void 0!==c?c:"",onChange:e=>v("protein",e.target.value?Number(e.target.value):0,"nutrition"),min:"0",step:"0.1"}),(0,s.jsx)(C,{label:"Carbs",type:"number",value:null!==(d=f.nutrition.carbs)&&void 0!==d?d:"",onChange:e=>v("carbs",e.target.value?Number(e.target.value):0,"nutrition"),min:"0",step:"0.1"}),(0,s.jsx)(C,{label:"Fat",type:"number",value:null!==(x=f.nutrition.fat)&&void 0!==x?x:"",onChange:e=>v("fat",e.target.value?Number(e.target.value):0,"nutrition"),min:"0",step:"0.1"}),(0,s.jsx)(C,{label:"Fiber",type:"number",value:null!==(m=f.nutrition.fiber)&&void 0!==m?m:"",onChange:e=>v("fiber",e.target.value?Number(e.target.value):0,"nutrition"),min:"0",step:"0.1"})]})]})]})}),(0,s.jsx)(u.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.5},children:(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>_(!R),className:"text-blue-400 hover:text-blue-300 mb-3",children:R?"Hide Notes":"Notes"}),R&&(0,s.jsxs)("div",{children:[(0,s.jsx)("textarea",{value:f.data.notes||"",onChange:e=>v("notes",e.target.value),className:"w-full bg-gray-700 rounded-lg px-3 py-2 focus:ring-2 ring-blue-500 focus:outline-none",rows:3,placeholder:"Add any notes about this item..."}),I.notes&&(0,s.jsx)("span",{className:"text-red-400 text-sm mt-1",children:I.notes})]})]})}),I.form&&(0,s.jsx)("div",{className:"text-red-400 text-sm mt-4",children:I.form}),(0,s.jsxs)(u.P.div,{className:"flex justify-end gap-3 mt-6",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:[(0,s.jsx)("button",{type:"button",onClick:h,className:"px-4 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600",children:"Cancel"}),(0,s.jsx)(u.P.button,{type:"submit",disabled:w,className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-400 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:w?"Saving...":y?"Save Changes":"Add Item"})]})]})]})})})})]})}function E(e){let{recipe:t,pantryItems:a,onClose:n}=e,r=h(),{handleError:c}=j(),[d,u]=(0,i.useState)(!1),[x,m]=(0,i.useState)(!1),[g,y]=(0,i.useState)("review"),[b,f]=(0,i.useState)(t.data.servings),[N,C]=(0,i.useState)(null),k=(0,i.useCallback)(()=>{let e=new Map,s=b/t.data.servings;return t.data.ingredients.forEach(t=>{let i=a.find(e=>e.data.name.toLowerCase()===t.name.toLowerCase());if(i){var n,r,l;let a=i.data.unit===t.unit,o=t.quantity*s;e.set(i.id,{...i,initial:null!==(n=i.data.quantity)&&void 0!==n?n:0,final:a?Math.max(0,(null!==(r=i.data.quantity)&&void 0!==r?r:0)-o):null!==(l=i.data.quantity)&&void 0!==l?l:0,matches:a})}}),e},[t,a,b]),[S,E]=(0,i.useState)(()=>k());(0,i.useEffect)(()=>{E(k())},[t,a,k]);let A=async e=>{if(N)try{let i=new Map(S),n=i.get(N.id);if(n){var a,s;let r=t.data.ingredients.find(t=>t.name.toLowerCase()===e.data.name.toLowerCase()),l=!!r&&e.data.unit===r.unit,o=!l&&e.data.quantity!==n.data.quantity&&e.data.unit===n.data.unit,c={...n,data:{...n.data,...e.data},nutrition:e.nutrition,matches:l||o,initial:null!==(a=n.data.quantity)&&void 0!==a?a:0,final:null!==(s=e.data.quantity)&&void 0!==s?s:0};E(new Map(i.set(N.id,c)))}C(null)}catch(e){c(e)}},P=async()=>{if(!d){u(!0),m(!0);try{await o.Ay.promise(r.useRecipe(t.id,t.data.servings,Object.fromEntries(Array.from(S).map(e=>{let[t,a]=e;return[t,p(a.initial-a.final)]}))),{loading:"Using recipe...",success:"Recipe used successfully!",error:"Failed to use recipe"}),n()}catch(e){c(e)}finally{m(!1),u(!1)}}};return(0,s.jsxs)(l.lG,{open:!0,onClose:n,className:"relative z-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsxs)(l.lG.Panel,{className:"w-full max-w-2xl rounded-xl bg-gray-900 p-6",children:[(0,s.jsx)(l.lG.Title,{className:"text-2xl font-bold text-white mb-4",children:"review"===g?"Use Recipe":"Confirm Ingredients"}),"review"===g?(0,s.jsx)(v,{recipe:t,pantryItems:a,servings:b,onServingsChange:f,onContinue:()=>y("confirm"),onClose:n}):(0,s.jsx)(w,{recipe:t,pantryItems:a,finalQuantities:S,onBack:()=>y("review"),onConfirm:P,isConfirming:x,onEditItem:C}),N&&(0,s.jsx)(I,{initialValues:{data:N.item.data,nutrition:N.item.nutrition},onAdd:A,onClose:()=>C(null),isEditing:!0})]})})})]})}var A=a(4247);function P(e){let{activeSection:t,setActiveSection:a,onGenerate:i,isGenerating:n,isLoading:r,pantryItemsCount:l}=e,{preferences:o,setPreferences:c}=h(),d=e=>{c({...o,...e})},x={cuisine:["Italian","Asian","Mexican","Indian","American","Mediterranean","French","Japanese","Thai","Greek","Other"],dietary:["Vegetarian","Vegan","Gluten-Free","Dairy-Free","Keto","Low-Carb","Paleo"],mealTypes:["Breakfast","Lunch","Dinner","Snack"],nutritionGoals:["High Protein","Low Carb","Low Fat","Low Calorie","High Fiber","Low Sugar","Balanced"]},m=(e,t)=>{let a=o[e];c({[e]:a.includes(t)?a.filter(e=>e!==t):[...a,t]})},g=(e,t,a)=>(0,s.jsx)("div",{className:"flex flex-wrap gap-3",children:e.map(e=>(0,s.jsx)("button",{onClick:()=>m(t,e),className:"\n            px-4 py-2 rounded-lg text-sm transition-all\n            ".concat(o[t].includes(e)?"orange"===a?"bg-orange-500/20 text-orange-400 ring-1 ring-orange-500/50 shadow-lg shadow-orange-500/10 bg-gradient-to-br from-orange-500/30 to-orange-500/10":"blue"===a?"bg-blue-500/20 text-blue-400 ring-1 ring-blue-500/50 shadow-lg shadow-blue-500/10 bg-gradient-to-br from-blue-500/30 to-blue-500/10":"purple"===a?"bg-purple-500/20 text-purple-400 ring-1 ring-purple-500/50 shadow-lg shadow-purple-500/10 bg-gradient-to-br from-purple-500/30 to-purple-500/10":"bg-green-500/20 text-green-400 ring-1 ring-green-500/50 shadow-lg shadow-green-500/10 bg-gradient-to-br from-green-500/30 to-green-500/10":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:shadow-md","\n          "),children:e},e))});return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsxs)("button",{onClick:()=>a(t?null:"preferences"),className:"\n            px-4 py-2 rounded-full transition-all flex items-center justify-center gap-1.5 text-sm\n            ".concat(t?"bg-indigo-500/20 text-indigo-300 ring-1 ring-indigo-500/30 hover:bg-indigo-500/30":"bg-gray-800 text-gray-300 hover:bg-gray-700/80","\n            transform hover:scale-105 active:scale-95\n          "),children:[(0,s.jsx)("span",{className:"text-sm",children:"✨"}),"Customize"]}),(0,s.jsx)("button",{onClick:i,disabled:n||r||0===l,className:"\n            px-4 py-2 rounded-lg transition-all text-sm font-medium \n            flex items-center justify-center gap-1.5\n            transform hover:scale-105 active:scale-95\n            ".concat(n||r||0===l?"bg-gray-800 text-gray-500 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white shadow-lg shadow-green-500/20","\n          "),children:n||r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"animate-spin",children:"⟳"}),n?"Generating...":"Loading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-sm",children:"\uD83E\uDE84"}),"Generate"]})})]}),(0,s.jsx)(A.N,{children:"preferences"===t&&(0,s.jsx)(u.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-800",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Max Preparation Time"}),(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("span",{className:"text-sm text-gray-400",children:o.max_prep_time?"".concat(o.max_prep_time," mins"):"Any time"})}),(0,s.jsx)("input",{type:"range",min:"0",max:"120",step:"5",value:o.max_prep_time||0,onChange:e=>d({max_prep_time:parseInt(e.target.value)||void 0}),className:"w-full accent-indigo-500 bg-gray-700 rounded-lg h-2 appearance-none cursor-pointer"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:"Any time"}),(0,s.jsx)("span",{children:"2 hours"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Max Calories per Serving"}),(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("span",{className:"text-sm text-gray-400",children:o.max_calories?"".concat(o.max_calories," kcal"):"Any"})}),(0,s.jsx)("input",{type:"range",min:"0",max:"1200",step:"50",value:o.max_calories||0,onChange:e=>d({max_calories:parseInt(e.target.value)||void 0}),className:"w-full accent-indigo-500 bg-gray-700 rounded-lg h-2 appearance-none cursor-pointer"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:"Any"}),(0,s.jsx)("span",{children:"1200 kcal"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Min Protein per Serving"}),(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("span",{className:"text-sm text-gray-400",children:o.min_protein?"".concat(o.min_protein,"g"):"Any"})}),(0,s.jsx)("input",{type:"range",min:"0",max:"100",step:"5",value:o.min_protein||0,onChange:e=>d({min_protein:parseInt(e.target.value)||void 0}),className:"w-full accent-indigo-500 bg-gray-700 rounded-lg h-2 appearance-none cursor-pointer"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:"Any"}),(0,s.jsx)("span",{children:"100g"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Meal Type"}),(0,s.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,s.jsx)("div",{className:"flex flex-nowrap gap-2",children:g(x.mealTypes,"meal_types","blue")})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Cuisine"}),(0,s.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,s.jsx)("div",{className:"flex flex-nowrap gap-2",children:g(x.cuisine,"cuisine","purple")})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Dietary Preferences"}),(0,s.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,s.jsx)("div",{className:"flex flex-nowrap gap-2",children:g(x.dietary,"dietary","green")})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Nutrition Goals"}),(0,s.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,s.jsx)("div",{className:"flex flex-nowrap gap-2",children:g(x.nutritionGoals,"nutrition_goals","orange")})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Serving Size"}),(0,s.jsx)("input",{type:"number",min:"1",max:"12",value:o.serving_size||"",onChange:e=>d({serving_size:e.target.value?parseInt(e.target.value):void 0}),className:"w-full bg-gray-800 rounded-lg px-3 py-2 text-white",placeholder:"e.g., 4"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Additional Preferences"}),(0,s.jsx)("textarea",{value:o.custom_preferences||"",onChange:e=>d({custom_preferences:e.target.value}),placeholder:"Any specific preferences, allergies, or dietary restrictions...",className:"w-full bg-gray-800 rounded-lg px-3 py-2 text-white min-h-[80px]"})]})]})})})]})}function D(e){let{onClose:t,pantryItemsCount:a}=e,{handleError:n}=j(),{isLoading:r,isGenerating:o,setIsLoading:d,setIsGenerating:u,setRecipes:x,preferences:m,setError:g}=h(),[p,y]=(0,i.useState)(null),b=async()=>{d(!0),u(!0),g(null);try{let e=await c.Hv.generate(m);x(e),t()}catch(e){n(e)}finally{d(!1),u(!1)}};return(0,s.jsxs)(l.lG,{open:!0,onClose:t,className:"relative z-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsxs)(l.lG.Panel,{className:"w-full max-w-4xl rounded-xl bg-gray-900 p-6 shadow-lg border border-gray-800",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)("div",{children:(0,s.jsx)("img",{src:"/images/elf2.webp",alt:"Kitchen Elf",className:"w-16 h-16 object-contain rounded-lg"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.lG.Title,{className:"text-3xl font-bold text-white",children:"Recipes"}),(0,s.jsx)("p",{className:"text-gray-400 italic",children:"Set your preferences"})]})]}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-white text-xl",children:"✕"})]}),(0,s.jsx)(P,{activeSection:p,setActiveSection:y,onGenerate:b,isGenerating:o,isLoading:r,pantryItemsCount:a})]})})})]})}function R(e){var t,a;let{recipe:i,availability:n,className:r=""}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-2 items-center text-sm ".concat(r),children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-gray-400",children:[(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["⏱️ ",i.data.preparation_time,"m"]}),(null===(t=i.data.nutrition)||void 0===t?void 0:t.calories)&&(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["\uD83D\uDD25 ",i.data.nutrition.calories,"cal"]}),(null===(a=i.data.nutrition)||void 0===a?void 0:a.protein)&&(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["\uD83D\uDCAA ",i.data.nutrition.protein,"g"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-end text-gray-400",children:[i.data.price&&(0,s.jsxs)("span",{className:"whitespace-nowrap",children:["$",i.data.price.toFixed(2)]}),void 0!==n&&(0,s.jsxs)("span",{className:"whitespace-nowrap flex items-center gap-1 ".concat(n>=75?"text-green-400":n>=50?"text-yellow-400":"text-red-400"),children:["\uD83E\uDD6B ",Math.round(n),"%"]})]})]})}function _(e){let{recipe:t,pantryItems:a,onClick:i}=e,{percentage:n}=y(t,a);return(0,s.jsx)(u.P.div,{onClick:i,className:"backdrop-blur-sm p-5 rounded-lg cursor-pointer transition-colors min-h-[140px] flex flex-col justify-between\n        ".concat(n>=80?"bg-green-900/30 hover:bg-green-800/30":n>=50?"bg-yellow-900/30 hover:bg-yellow-800/30":"bg-red-900/30 hover:bg-red-800/30"),whileHover:{scale:1.02},transition:{type:"spring",stiffness:300},children:(0,s.jsxs)("div",{className:"flex flex-col justify-between h-full",children:[(0,s.jsx)("h4",{className:"font-medium text-white text-base leading-snug line-clamp-3",children:t.data.name}),(0,s.jsx)(R,{recipe:t,availability:n,className:"mt-3"})]})})}function T(e){let{onClick:t,pantryItemsCount:a,isGenerating:i}=e;return(0,s.jsx)(A.N,{children:(0,s.jsx)(u.P.div,{className:"fixed bottom-6 right-6 z-50",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:(0,s.jsxs)(u.P.button,{onClick:t,disabled:0===a||i,className:"\n            relative flex items-center gap-2 px-6 py-3 rounded-full\n            bg-gradient-to-r from-green-600 to-blue-600\n            text-white shadow-lg hover:shadow-xl\n            disabled:opacity-50 disabled:cursor-not-allowed\n            transition-shadow duration-200\n          ",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,s.jsx)(u.P.div,{className:"absolute inset-0 rounded-full bg-white opacity-0",animate:{opacity:[0,.15,0],scale:[1,1.2,1]},transition:{duration:8,repeat:1/0,ease:"easeInOut",times:[0,.5,1]}}),(0,s.jsxs)(u.P.span,{className:"text-xl relative",animate:{rotate:i?360:0},transition:{duration:2,repeat:i?1/0:0,ease:"linear"},children:["\uD83E\uDE84",!i&&(0,s.jsx)(u.P.span,{className:"absolute -top-1 -right-1 text-xs",animate:{scale:[1,1.2,1],opacity:[1,.5,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:"✨"})]}),(0,s.jsx)("span",{className:"font-medium",children:i?"Generating...":"Generate Recipes"})]})})})}var F=a(6092);function L(e){let{pantryItems:t}=e,{recipes:a,isLoading:n,isGenerating:r,error:l,fetchRecipes:c}=h(),[d,u]=(0,i.useState)(null),[x,m]=(0,i.useState)(null),[g,p]=(0,i.useState)(!1),[y,j]=(0,i.useState)(null),f=(0,i.useMemo)(()=>a.reduce((e,t)=>{let a=new Date(t.created_at).toISOString().split("T")[0];return e[a]||(e[a]=[]),e[a].length<10&&e[a].push(t),e},{}),[a]),v=(0,i.useMemo)(()=>Object.keys(f).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()).slice(0,5),[f]);(0,i.useEffect)(()=>{(async()=>{try{await c()}catch(e){console.error("Error fetching recipes:",e),e instanceof F.U?404!==e.error.status&&(j(e.error.message),o.oR.error("Failed to load recipes")):(j("Failed to load recipes. Please check your connection and try again."),o.oR.error("Failed to load recipes"))}})()},[c]);let N=e=>{h.getState().setRecipes(t=>t.filter(t=>t.id!==e))};return n||r?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:r?"Generating your recipes...":"Loading recipes..."})]}):y&&!y.includes("404")?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 text-red-400 px-4 py-3 rounded-lg mb-4",children:y}),(0,s.jsx)("button",{onClick:()=>{j(null),c()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Try Again"})]}):0===a.length?(0,s.jsx)("div",{className:"text-center py-12 space-y-4",children:(0,s.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-8 backdrop-blur-sm max-w-lg mx-auto",children:[(0,s.jsx)("h3",{className:"text-xl font-medium text-white mb-2",children:"No Recipes Yet"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Get started by clicking the wand to generate your first batch of AI-powered recipes based on your pantry items."})]})}):(0,s.jsxs)("div",{className:"space-y-8",children:[v[0]&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400",children:"Current Generation"}),(0,s.jsx)("span",{className:"text-gray-400",children:"✨"})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Recipes tailored to your ",t.length," pantry items"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f[v[0]].slice(0,8).map(e=>(0,s.jsx)(_,{recipe:e,pantryItems:t,onClick:()=>u(e)},e.id))})]}),v.slice(1).map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400 mb-4",children:new Date(e).toLocaleDateString()}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f[e].slice(0,4).map(e=>(0,s.jsx)(_,{recipe:e,pantryItems:t,onClick:()=>u(e)},e.id))})]},e)),d&&(0,s.jsx)(b,{recipe:d,onClose:()=>u(null),onUse:()=>{m(d),u(null)},onRemove:()=>{N(d.id),u(null)},pantryItems:t}),x&&(0,s.jsx)(E,{recipe:x,pantryItems:t,onClose:()=>m(null),onConfirmUse:async e=>{try{await h.getState().useRecipe(x.id,x.data.servings,e),m(null)}catch(e){console.error("Error using recipe:",e),o.oR.error("Failed to use recipe")}}}),g&&(0,s.jsx)(D,{onClose:()=>p(!1),pantryItemsCount:t.length}),(0,s.jsx)(T,{onClick:()=>p(!0),pantryItemsCount:t.length,isGenerating:r})]})}let z={OTHER:"other"},q={[z.OTHER]:"Other"},O=e=>e?e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):q[z.OTHER],M=(0,i.memo)(function(e){let{categories:t,selectedCategories:a,onSelectCategory:i,onClearCategories:n}=e,{items:r}=g(),l=[...t].sort((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase())),o=l.slice(0,5),c=l.slice(5);return(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[o.map(e=>(0,s.jsxs)("button",{onClick:()=>i(e.toLowerCase()),className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-colors\n            ".concat(a.includes(e.toLowerCase())?"bg-blue-600/30 text-blue-400 ring-1 ring-blue-500/50":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:[O(e),(0,s.jsx)("span",{className:"ml-1.5 text-xs opacity-60",children:r.filter(t=>(t.data.category||z.OTHER).toLowerCase()===e.toLowerCase()).length})]},e)),c.length>0&&(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("select",{onChange:e=>i(e.target.value),className:"bg-gray-800 text-gray-400 px-3 py-1.5 rounded-lg text-sm appearance-none cursor-pointer hover:bg-gray-700",children:[(0,s.jsx)("option",{value:"",children:"More categories..."}),c.map(e=>(0,s.jsx)("option",{value:e.toLowerCase(),children:O(e)},e))]})}),a.length>0&&(0,s.jsxs)("button",{onClick:n,className:"text-sm text-gray-400 hover:text-gray-300 px-2 py-1",children:["Clear (",a.length,")"]})]})});function U(e){let{content:t,children:a}=e;return(0,s.jsxs)("div",{className:"group relative",children:[a,(0,s.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:t})]})}var G=a(7721),B=a(6743),H=a(1572),J=a(9904),V=a(8552),Q=a(7553),Y=a(8715);function X(e){let{searchTerm:t,onSearchChange:a,onAddItem:i,onUploadReceipt:n,onClearPantry:r,isUploading:l,fileInputRef:o,pantryItemsCount:c,showSearch:d,setShowSearch:u,showFilters:x,setShowFilters:m}=e;return(0,s.jsxs)("div",{className:"space-y-1 sm:space-y-0",children:[d&&(0,s.jsxs)("div",{className:"sm:hidden relative w-full animate-slideDown mb-2",children:[(0,s.jsx)(G.A,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search items...",value:t,onChange:e=>a(e.target.value),className:"bg-gray-800/50 rounded-lg pl-9 pr-3 py-2 text-white w-full focus:ring-2 ring-blue-500 focus:outline-none text-base",autoFocus:!0}),(0,s.jsx)("button",{onClick:()=>u(!1),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white",children:(0,s.jsx)(B.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"hidden sm:flex items-center justify-center gap-2",children:[(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)(G.A,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search items...",value:t,onChange:e=>a(e.target.value),className:"bg-gray-800/50 rounded-lg pl-9 pr-3 py-1.5 text-white w-full focus:ring-2 ring-blue-500 focus:outline-none text-sm"})]}),(0,s.jsxs)("button",{onClick:()=>m(!x),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-sm ".concat(x?"bg-blue-600/20 text-blue-400 ring-1 ring-blue-500/50":"bg-gray-800/50 text-gray-400 hover:text-white"),children:[(0,s.jsx)(H.A,{className:"w-4 h-4"}),"Filter"]}),(0,s.jsx)("input",{type:"file",ref:o,onChange:n,className:"hidden",accept:"image/*"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:i,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-600/20 hover:bg-green-600/30 text-green-400 transition-colors text-sm",children:[(0,s.jsx)(J.A,{className:"w-4 h-4"}),"Add Item"]}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-sm ".concat(l?"bg-gray-700/50 text-gray-400 cursor-not-allowed":"bg-blue-600/20 hover:bg-blue-600/30 text-blue-400"),disabled:l,children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(V.A,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.A,{className:"w-4 h-4"}),"Upload Receipt"]})}),(0,s.jsxs)("button",{onClick:r,disabled:0===c,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-red-900/20 hover:bg-red-900/30 text-red-300/70 transition-colors disabled:opacity-50 text-sm",children:[(0,s.jsx)(Y.A,{className:"w-4 h-4"}),"Clear"]})]})]}),(0,s.jsxs)("div",{className:"relative sm:hidden",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2"}),(0,s.jsxs)("div",{className:"flex gap-2 justify-start",children:[(0,s.jsx)("button",{onClick:()=>u(!0),className:"w-10 h-10 rounded-full bg-gray-800/50 text-gray-400 hover:text-white flex items-center justify-center",children:(0,s.jsx)(G.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>m(!x),className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(x?"bg-blue-600/20 text-blue-400":"bg-gray-800/50 text-gray-400 hover:text-white"),children:(0,s.jsx)(H.A,{className:"w-5 h-5"})}),(0,s.jsx)(U,{content:"Add Item",children:(0,s.jsx)("button",{onClick:i,className:"w-10 h-10 rounded-full bg-green-600/20 text-green-400 hover:bg-green-600/30 flex items-center justify-center",children:(0,s.jsx)(J.A,{className:"w-5 h-5"})})}),(0,s.jsx)(U,{content:"Upload Receipt",children:(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},disabled:l,className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(l?"bg-gray-700/50 text-gray-400":"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30"),children:l?(0,s.jsx)(V.A,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(Q.A,{className:"w-5 h-5"})})}),(0,s.jsx)(U,{content:"Clear Pantry",children:(0,s.jsx)("button",{onClick:r,disabled:0===c,className:"w-10 h-10 rounded-full bg-red-600/20 text-red-400 hover:bg-red-600/30 disabled:opacity-50 flex items-center justify-center",children:(0,s.jsx)(Y.A,{className:"w-5 h-5"})})})]}),(0,s.jsx)("input",{type:"file",ref:o,onChange:n,className:"hidden",accept:"image/*"})]})]})}var Z=a(743);function K(e){let{item:t,onSelect:a,onDelete:i}=e,{attributes:n,listeners:r,setNodeRef:l,transform:o}=(0,Z.PM)({id:t.id,data:t}),c=o?{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0)"),transition:"none",touchAction:"none",zIndex:100}:void 0;return(0,s.jsxs)("div",{ref:l,style:c,...n,className:"bg-gray-800/50 rounded-lg p-2 group hover:bg-gray-700/80 relative border border-gray-700/50 will-change-transform active:bg-gray-700/80",children:[(0,s.jsx)("div",{className:"absolute top-2.5 right-2.5 flex gap-1.5 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 sm:group-active:opacity-100 transition-opacity z-10",children:(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i(t.id)},className:"p-0.5 rounded-lg text-gray-400 hover:text-red-400",children:(0,s.jsx)(Y.A,{className:"h-4 w-4"})})}),(0,s.jsx)("div",{onClick:()=>a(t),className:"cursor-pointer",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-base font-medium text-white leading-tight",children:t.data.name}),(0,s.jsxs)("div",{className:"flex items-baseline gap-2 mt-0.5",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-300",children:[t.data.quantity," ",t.data.unit]}),t.data.expiry_date&&(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.data.expiry_date).toLocaleDateString()]})]})]}),t.data.notes&&(0,s.jsx)("p",{className:"text-xs text-gray-400 italic",children:t.data.notes})]})}),(0,s.jsx)("div",{...r,className:"absolute bottom-3 right-3 cursor-move opacity-100 sm:opacity-0 sm:group-hover:opacity-100 sm:group-active:opacity-100 transition-opacity",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 hover:text-gray-300",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fill:"currentColor",d:"M7 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm6 0a2 2 0 1 1 0 4 2 2 0 0 1 0-4zM7 8a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm6 0a2 2 0 1 1 0 4 2 2 0 0 1 0-4zM7 14a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm6 0a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"})})})]})}function W(e){let{category:t,children:a}=e,{setNodeRef:i}=(0,Z.zM)({id:t});return(0,s.jsxs)("div",{ref:i,className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:t}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a})]})}function $(e){let{groupedItems:t,onSelectItem:a}=e,{deleteItem:i,updateItem:n}=g(),r=async e=>{let{active:t,over:a}=e;if(a&&t.data.current){let e=a.id,s=t.data.current;if(s.data.category!==e){n(t.id,{data:{...s.data,category:e}});try{await c.dt.updateItem(t.id,{data:{...s.data,category:e}})}catch(e){console.error("Failed to update item category:",e),n(t.id,{data:{...s.data,category:s.data.category}})}}}},l=Object.entries(t).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)});return(0,s.jsx)(Z.Mp,{onDragEnd:r,children:(0,s.jsx)("div",{className:"space-y-8",children:l.map(e=>{let[t,n]=e;return(0,s.jsx)(W,{category:t,children:n.map(e=>(0,s.jsx)(K,{item:e,onSelect:a,onDelete:i},e.id))},t)})})})}let ee=e=>{let{message:t,className:a=""}=e;return(0,s.jsxs)("div",{className:"text-center py-8 ".concat(a),children:[(0,s.jsx)("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-4"}),t&&(0,s.jsx)("p",{className:"text-gray-400",children:t})]})};function et(e){let{message:t,onDismiss:a}=e;return(0,s.jsxs)("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded relative",children:[(0,s.jsx)("span",{className:"block sm:inline",children:t}),a&&(0,s.jsx)("button",{onClick:a,className:"absolute top-0 bottom-0 right-0 px-4 py-3","aria-label":"Dismiss error",children:(0,s.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]})}let ea={GENERIC:"An unexpected error occurred"};function es(e){let{existingItem:t,newItem:a,onMergeQuantities:i,onMergeAndEdit:n,onCreateNew:r,onCancel:l,isProcessing:o=!1}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-xl w-full space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-yellow-400",children:"Similar Item Found"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gray-700/50 p-4 rounded-lg border border-gray-600",children:[(0,s.jsx)("h3",{className:"font-medium mb-2 text-gray-300",children:"Existing Item:"}),(0,s.jsx)("p",{className:"text-lg",children:t.data.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:["Quantity: ",t.data.quantity," ",t.data.unit]})]}),(0,s.jsxs)("div",{className:"bg-gray-700/50 p-4 rounded-lg border border-gray-600",children:[(0,s.jsx)("h3",{className:"font-medium mb-2 text-gray-300",children:"New Item:"}),(0,s.jsx)("p",{className:"text-lg",children:a.data.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:["Quantity: ",a.data.quantity," ",a.data.unit]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:i,disabled:o,className:"w-full px-4 py-3 bg-blue-500 hover:bg-blue-400 rounded-lg flex items-center justify-center gap-2\n              ".concat(o?"opacity-50 cursor-not-allowed":""),children:o?"Processing...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-lg",children:"+"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:"Merge Quantities"}),(0,s.jsxs)("div",{className:"text-sm text-blue-200",children:["Combined: ",t.data.quantity+a.data.quantity," ",t.data.unit]})]})]})}),(0,s.jsxs)("button",{onClick:n,disabled:o,className:"w-full px-4 py-3 bg-purple-500 hover:bg-purple-400 rounded-lg flex items-center justify-center gap-2\n              ".concat(o?"opacity-50 cursor-not-allowed":""),children:[(0,s.jsx)("span",{children:"✏️"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:"Merge and Edit Details"}),(0,s.jsx)("div",{className:"text-sm text-purple-200",children:"Combine and modify item properties"})]})]}),(0,s.jsx)("button",{onClick:r,disabled:o,className:"w-full px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg\n              ".concat(o?"opacity-50 cursor-not-allowed":""),children:"Create as Separate Item"}),(0,s.jsx)("button",{onClick:l,disabled:o,className:"w-full px-4 py-2 text-gray-400 hover:text-gray-300 hover:bg-gray-800/50 rounded-lg\n              ".concat(o?"opacity-50 cursor-not-allowed":""),children:"Cancel"})]})]})})}let ei=(0,m.v)((e,t)=>({duplicateItem:null,pendingDuplicates:[],isProcessing:!1,isEditing:!1,setDuplicateItem:t=>e({duplicateItem:t}),setPendingDuplicates:t=>e({pendingDuplicates:t}),setIsProcessing:t=>e({isProcessing:t}),setIsEditing:t=>e({isEditing:t}),handleItems:async(t,a)=>{let s=[],i=[];if(t.forEach(e=>{let t=a.find(t=>t.data.name.toLowerCase()===e.data.name.toLowerCase());t?s.push({existing:t,new:e}):i.push(e)}),i.length>0)try{let e=await c.dt.addItems(i);await g.getState().addItems(e)}catch(e){throw console.error("Error adding new items:",e),e}s.length>0&&e({pendingDuplicates:s,duplicateItem:s[0]})},processNextDuplicate:()=>{let{pendingDuplicates:a}=t(),s=a.slice(1);e({pendingDuplicates:s,duplicateItem:s.length>0?s[0]:null}),0===s.length&&o.oR.success("All items processed")},handleEditComplete:async(a,s)=>{let{duplicateItem:i}=t();if(i)try{e({isProcessing:!0});let n=await c.dt.updateItem(i.existing.id,a);await s(i.existing.id,n),e({isEditing:!1}),t().processNextDuplicate()}catch(t){throw e({isProcessing:!1}),t}},clearDuplicates:()=>e({duplicateItem:null,pendingDuplicates:[],isProcessing:!1,isEditing:!1}),handleDuplicateResolution:async(a,s,i)=>{let{duplicateItem:n}=t();if(n&&!t().isProcessing){e({isProcessing:!0});try{switch(a){case"merge":{let e={data:{...n.existing.data,quantity:n.existing.data.quantity+n.new.data.quantity}},a=await c.dt.updateItem(n.existing.id,e);await i(n.existing.id,a),t().processNextDuplicate();break}case"mergeEdit":e({isEditing:!0,isProcessing:!1});break;case"create":{let[e]=await c.dt.addItems([n.new]);await s([e]),t().processNextDuplicate()}}}catch(e){throw console.error("Error resolving duplicate:",e),e}finally{"mergeEdit"!==a&&e({isProcessing:!1})}}}})),en=(0,m.v)(e=>({isUploading:!1,receiptImage:null,pendingItems:[],error:null,showConfirmation:!1,uploadState:"idle",handleFileUpload:async t=>{var a;let s=null===(a=t.target.files)||void 0===a?void 0:a[0];if(!s)return!1;e({isUploading:!0,error:null});try{let a=new FormData;a.append("file",s,s.name);let i=URL.createObjectURL(s);e({receiptImage:i});let n=await c.dt.receipt.process(a);return e({pendingItems:n,showConfirmation:!0}),t.target.value="",!0}catch(t){return e({error:"Failed to process receipt"}),console.error("Receipt upload error:",t),!1}finally{e({isUploading:!1})}},clearUpload:()=>{e({receiptImage:null,pendingItems:[],error:null,showConfirmation:!1,uploadState:"idle"})},setShowConfirmation:t=>e({showConfirmation:t}),setError:t=>e({error:t}),setUploadState:t=>e({uploadState:t})}));function er(){let{items:e,isLoading:t,addItems:a,setItems:n,updateItem:r,fetchItems:l}=g(),{error:u,handleError:x,clearError:m}=j(),{isUploading:p,handleFileUpload:h,error:y,clearUpload:b}=en(),{duplicateItem:f,isProcessing:v,isEditing:N,handleDuplicateResolution:w,handleEditComplete:C,clearDuplicates:k}=ei(),[S,E]=(0,i.useState)([]),[A,P]=(0,i.useState)(""),[D,R]=(0,i.useState)(!1),[_,T]=(0,i.useState)(null),F=(0,i.useRef)(null),[L,q]=(0,i.useState)(!1),[U,Z]=(0,i.useState)(!1);if(t)return(0,s.jsx)(ee,{message:"Loading pantry items..."});let K=async t=>{try{await ei.getState().handleItems([t],e)}catch(e){x(e)}},W=async()=>{if(confirm("Are you sure you want to clear all items from your pantry?"))try{await c.dt.clearPantry(),(0,d.u4)("clear_pantry",{itemCount:e.length}),n([]),E([]),P(""),T(null),m(),b&&b()}catch(e){x(e),await l()}},er=Object.fromEntries(Object.entries(e.filter(e=>{let t=e.data.name.toLowerCase().includes(A.toLowerCase()),a=(e.data.category||z.OTHER).toLowerCase(),s=0===S.length||S.includes(a);return t&&s}).reduce((e,t)=>{let a=O(t.data.category);return e[a]||(e[a]=[]),e[a].push(t),e},{})).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)})),el=Array.from(new Set(e.map(e=>e.data.category||"Other"))),eo=async e=>{try{await h(e)&&en.getState().setShowConfirmation(!0)}catch(e){x(e)}},ec=async(e,t)=>{try{await r(e,t)}catch(e){x(e)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(u||y)&&(0,s.jsx)(et,{message:u||y||ea.GENERIC,onDismiss:m}),(0,s.jsxs)("div",{className:"sm:hidden",children:[L&&(0,s.jsxs)("div",{className:"relative w-full animate-slideDown mb-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search items...",value:A,onChange:e=>P(e.target.value),className:"bg-gray-800/50 rounded-lg px-4 py-2 text-white w-full focus:ring-2 ring-blue-500 focus:outline-none text-base",autoFocus:!0}),(0,s.jsx)("button",{onClick:()=>{q(!1),P("")},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-1",children:(0,s.jsx)(B.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-start",children:[(0,s.jsx)("button",{onClick:()=>Z(!U),className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(U?"bg-blue-600/20 text-blue-400":"bg-gray-800/50 text-gray-400 hover:text-white"),children:(0,s.jsx)(H.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>q(!0),className:"w-10 h-10 rounded-full bg-gray-800/50 text-gray-400 hover:text-white flex items-center justify-center",children:(0,s.jsx)(G.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>R(!0),className:"w-10 h-10 rounded-full bg-green-600/20 text-green-400 hover:bg-green-600/30 flex items-center justify-center",children:(0,s.jsx)(J.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=F.current)||void 0===e?void 0:e.click()},disabled:p,className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(p?"bg-gray-700/50 text-gray-400":"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30"),children:p?(0,s.jsx)(V.A,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(Q.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:W,disabled:0===e.length,className:"w-10 h-10 rounded-full bg-red-900/20 text-red-300/70 hover:bg-red-900/30 disabled:opacity-50 flex items-center justify-center",children:(0,s.jsx)(Y.A,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsx)(X,{searchTerm:A,onSearchChange:P,onAddItem:()=>R(!0),onUploadReceipt:eo,onClearPantry:W,isUploading:p,fileInputRef:F,pantryItemsCount:e.length,showSearch:L,setShowSearch:q,showFilters:U,setShowFilters:Z})}),U&&(0,s.jsx)(M,{categories:el,selectedCategories:S,onSelectCategory:e=>{E(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onClearCategories:()=>E([])}),(0,s.jsx)($,{groupedItems:er,onSelectItem:T}),D&&(0,s.jsx)(I,{onAdd:K,onClose:()=>R(!1)}),f&&!N&&(0,s.jsx)(es,{existingItem:f.existing,newItem:f.new,onMergeQuantities:()=>w("merge",a,r),onMergeAndEdit:()=>w("mergeEdit",a,r),onCreateNew:()=>w("create",a,r),onCancel:()=>{k(),R(!1)},isProcessing:v}),N&&f&&(0,s.jsx)(I,{initialValues:{data:{...f.existing.data,quantity:f.existing.data.quantity+f.new.data.quantity},nutrition:f.existing.nutrition},onAdd:async e=>{try{await C(e,r),R(!1)}catch(e){o.oR.error("Failed to update item"),ei.getState().setIsProcessing(!1)}},onClose:()=>{ei.getState().setIsEditing(!1),ei.getState().setIsProcessing(!1),R(!1)},isEditing:!0}),_&&(0,s.jsx)(I,{initialValues:_,onAdd:async e=>{await ec(_.id,e),T(null)},onClose:()=>T(null),isEditing:!0})]})}var el=a(1506),eo=a(4371),ec=a(6472);function ed(e){let{recipe:t,interaction:a,pantryItems:i,onClick:n}=e,{percentage:r}=y(t,i);return(0,s.jsx)(u.P.div,{onClick:n,className:"bg-gray-800 rounded-lg overflow-hidden cursor-pointer",initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02,backgroundColor:"rgb(55, 65, 81)"},transition:{duration:.2,type:"spring",stiffness:300},children:(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:t.data.name}),(a.data,"rate"===a.type&&(0,s.jsx)(u.P.div,{className:"flex items-center gap-1",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.1},children:(0,s.jsx)(e=>{let{rating:t}=e;return(0,s.jsx)("div",{className:"flex",children:[1,2,3,4,5].map(e=>(0,s.jsx)("span",{children:e<=(null!=t?t:0)?(0,s.jsx)(eo.A,{className:"h-5 w-5 text-yellow-400"}):(0,s.jsx)(ec.A,{className:"h-5 w-5 text-yellow-400"})},e))})},{rating:a.data.rating})}))]}),(0,s.jsxs)(u.P.div,{className:"space-y-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[(0,s.jsx)(R,{recipe:t,availability:r}),(a.data,"save"===a.type&&a.data.folder&&(0,s.jsxs)(u.P.div,{className:"text-sm text-gray-400",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:["Folder: ",a.data.folder]})),(a.data,"rate"===a.type&&a.data.review&&(0,s.jsxs)(u.P.p,{className:"text-sm text-gray-300 italic",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:["“",a.data.review,"”"]})),(a.data,"cook"===a.type&&(0,s.jsxs)(u.P.div,{className:"text-sm text-gray-400",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:[(0,s.jsxs)("p",{children:["Servings made: ",a.data.servings_made]}),a.data.notes&&(0,s.jsxs)("p",{className:"text-gray-300 mt-1",children:["Notes: ",a.data.notes]})]})),(0,s.jsxs)(u.P.div,{className:"text-xs text-gray-500",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:["save"===a.type?"Saved":"rate"===a.type?"Rated":"Cooked"," on ",function(e){let t=new Date(e),a=Math.floor(Math.abs(new Date().getTime()-t.getTime())/864e5);return a<7?0===a?"Today":1===a?"Yesterday":"".concat(a," days ago"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}(a.created_at)]})]})]})})}function eu(e){let{interactions:t,pantryItems:a,onSelectRecipe:i}=e;return 0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-400",children:"No saved recipes yet."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Save recipes while browsing to add them to your cookbook."})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,s.jsx)(ed,{recipe:e.recipe,interaction:e,pantryItems:a,onClick:()=>i(e.recipe)},e.id))})}function ex(e){let{interactions:t}=e,a=t.filter(e=>"cook"===e.type),i=a.reduce((e,t)=>{let s=t.recipe.data.name,i=e.mostCooked.find(e=>e.recipeName===s);i?i.count++:e.mostCooked.push({recipeName:s,count:1});let n=t.data.servings_made,r=a.map(e=>new Date(e.created_at).getTime()),l=r.length>0?Math.max(...r):Date.now(),o=Math.floor((Date.now()-l)/864e5);return{totalCooks:e.totalCooks+1,totalServings:e.totalServings+n,mostCooked:e.mostCooked.sort((e,t)=>t.count-e.count).slice(0,3),recentlyCookedDays:o,averageServings:Math.round((e.totalServings+n)/(e.totalCooks+1)*10)/10}},{totalCooks:0,totalServings:0,mostCooked:[],recentlyCookedDays:0,averageServings:0});return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400",children:"Total Recipes Cooked"}),(0,s.jsx)("p",{className:"mt-2 text-2xl font-bold text-white",children:i.totalCooks}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:[i.totalServings," total servings"]})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400",children:"Average Servings"}),(0,s.jsx)("p",{className:"mt-2 text-2xl font-bold text-white",children:i.averageServings}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"per recipe"})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400",children:"Most Cooked"}),(0,s.jsx)("div",{className:"mt-2 space-y-1",children:i.mostCooked.map(e=>(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white truncate",children:e.recipeName}),(0,s.jsxs)("span",{className:"text-gray-400 ml-2",children:[e.count,"x"]})]},e.recipeName))})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400",children:"Recent Activity"}),a.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"mt-2 text-2xl font-bold text-white",children:[i.recentlyCookedDays," days"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"since last cooked"})]}):(0,s.jsx)("p",{className:"mt-2 text-white",children:"No cooking activity yet"})]})]})}function em(e){let{interactions:t,pantryItems:a,onSelectRecipe:i}=e;return 0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-400",children:"No cooking history yet."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Start cooking recipes to build your history."})]}):(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(ex,{interactions:t}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,s.jsx)(ed,{recipe:e.recipe,interaction:e,pantryItems:a,onClick:()=>null==i?void 0:i(e.recipe)},e.id))})]})}function eg(e){let{interactions:t,pantryItems:a,onSelectRecipe:n}=e,[r,l]=(0,i.useState)("rating"),o=[...t].sort((e,t)=>{if("rating"===r){var a,s;return(null!==(a=t.rating)&&void 0!==a?a:0)-(null!==(s=e.rating)&&void 0!==s?s:0)}return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("select",{value:r,onChange:e=>l(e.target.value),className:"bg-gray-700 text-white rounded-lg px-3 py-1",children:[(0,s.jsx)("option",{value:"rating",children:"Sort by Rating"}),(0,s.jsx)("option",{value:"date",children:"Sort by Date"})]})}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>(0,s.jsx)(ed,{recipe:e.recipe,interaction:e,pantryItems:a,onClick:()=>n(e.recipe)},e.id))})]})}function ep(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}function eh(){let[e,t]=(0,i.useState)([]),[a,n]=(0,i.useState)(!0),{items:r}=g(),[l,d]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),m=async()=>{try{n(!0);let e=await c.Hv.getInteractions();console.log("Raw interaction data:",e);let a=e.filter(e=>{if(!e.recipe)return!1;let t=e.recipe;return"object"==typeof t&&"id"in t&&"data"in t&&"object"==typeof t.data&&null!==t.data&&"name"in t.data});console.log("Valid interactions:",a),t(a)}catch(e){console.error("Error fetching interactions:",e),o.oR.error("Failed to load cookbook items")}finally{n(!1)}},p=e=>{d(e)};(0,i.useEffect)(()=>{m()},[]);let h=e.filter(e=>"save"===e.type&&e.recipe),y=e.filter(e=>"cook"===e.type&&e.recipe),j=e.filter(e=>"rate"===e.type&&e.recipe);return(0,s.jsxs)("div",{className:"w-full -mt-[1px]",children:[(0,s.jsxs)(el.oz.Group,{children:[(0,s.jsxs)(el.oz.List,{className:"flex border-b border-gray-800",children:[(0,s.jsx)(el.oz,{className:e=>{let{selected:t}=e;return ep("px-4 py-2 text-sm font-medium border-b-2 focus:outline-none -mb-[2px]",t?"border-blue-500 text-blue-500":"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-700")},children:"Saved Recipes"}),(0,s.jsx)(el.oz,{className:e=>{let{selected:t}=e;return ep("px-4 py-2 text-sm font-medium border-b-2 focus:outline-none -mb-[2px]",t?"border-blue-500 text-blue-500":"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-700")},children:"Rated Recipes"}),(0,s.jsx)(el.oz,{className:e=>{let{selected:t}=e;return ep("px-4 py-2 text-sm font-medium border-b-2 focus:outline-none -mb-[2px]",t?"border-blue-500 text-blue-500":"border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-700")},children:"Cooking History"})]}),(0,s.jsx)(el.oz.Panels,{className:"mt-4",children:a?(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-2"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Loading cookbook..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(el.oz.Panel,{children:(0,s.jsx)(eu,{interactions:h,pantryItems:r,onSelectRecipe:p})}),(0,s.jsx)(el.oz.Panel,{children:(0,s.jsx)(eg,{interactions:j,pantryItems:r,onSelectRecipe:p})}),(0,s.jsx)(el.oz.Panel,{children:(0,s.jsx)(em,{interactions:y,pantryItems:r,onSelectRecipe:p})})]})})]}),l&&(0,s.jsx)(b,{recipe:l,onClose:()=>d(null),onUse:()=>{x(l),d(null)},onRemove:()=>{d(null)},pantryItems:r}),u&&(0,s.jsx)(E,{recipe:u,pantryItems:r,onClose:()=>{x(null),d(null)},onConfirmUse:async e=>{try{await c.Hv.use(u.id,{servings_made:u.data.servings,ingredients_used:e}),await m(),x(null),d(null)}catch(e){console.error("Error using recipe:",e),o.oR.error("Failed to use recipe")}}})]})}var ey=a(6046),eb=a(5565);function ej(e){let{items:t,receiptImage:a,onCancel:n,onConfirm:r}=e,[l,o]=(0,i.useState)(t),[c,d]=(0,i.useState)(null),[u,x]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!1),p=(e,t)=>{o(a=>a.map((a,s)=>s===e?t:a)),d(null)},h=e=>{o(t=>t.filter((t,a)=>a!==e))},y=async()=>{g(!0);try{await r(l)}finally{g(!1)}};return(0,s.jsxs)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:[(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl h-[90vh] flex flex-col overflow-hidden",children:[(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row h-full",children:[(0,s.jsxs)("div",{className:"p-6 border-b lg:border-b-0 lg:border-r border-gray-700 lg:w-1/2",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Receipt Image"}),(0,s.jsx)("div",{className:"relative h-[300px] lg:h-[600px] bg-gray-900 rounded-lg overflow-hidden",children:a&&(0,s.jsx)(eb.default,{src:a,alt:"Receipt",fill:!0,className:"object-contain",sizes:"100vw",priority:!0})})]}),(0,s.jsx)("div",{className:"flex flex-col lg:w-1/2",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Detected Items"}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:[l.length," items found"]})]}),(0,s.jsxs)("button",{onClick:()=>x(!0),className:"px-3 py-1.5 rounded-lg bg-green-600/20 hover:bg-green-600/30 text-green-400 transition-colors flex items-center gap-2 text-sm",children:[(0,s.jsx)("span",{children:"+"}),"Add Item"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:l.map((e,t)=>(0,s.jsx)("div",{className:"bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors group",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>d(t),children:[(0,s.jsx)("div",{className:"font-medium text-lg",children:e.data.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-300 mt-1",children:[e.data.quantity," ",e.data.unit]}),e.data.category&&(0,s.jsxs)("div",{className:"text-sm text-gray-400 mt-1",children:["Category: ",e.data.category]})]}),(0,s.jsx)("button",{onClick:()=>h(t),className:"text-red-400 hover:text-red-300 p-2 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete item",children:"\uD83D\uDDD1️"})]})},t))})]})})]})}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-700 flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:n,disabled:m,className:"px-4 py-2 text-gray-400 hover:text-white disabled:opacity-50 text-sm",children:"Cancel"}),(0,s.jsx)("button",{onClick:y,disabled:m||0===l.length,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50 disabled:hover:bg-green-600 flex items-center gap-2 text-sm",children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"animate-spin",children:"⏳"}),(0,s.jsx)("span",{children:"Submitting..."})]}):"Confirm Items"})]})]}),null!==c&&(0,s.jsx)(I,{initialValues:l[c],onAdd:e=>p(c,e),onClose:()=>d(null),isEditing:!0}),u&&(0,s.jsx)(I,{onAdd:e=>{o(t=>[...t,e]),x(!1)},onClose:()=>x(!1)})]})}var ef=a(8173),ev=a.n(ef);function eN(e){let{onClose:t}=e,[a,n]=(0,i.useState)(""),[r,d]=(0,i.useState)(!1),x=async()=>{if(!a.trim()){o.oR.error("Please enter your feedback");return}d(!0);try{await c.cq.submit(a.trim()),o.oR.success("Thank you for your feedback!"),t()}catch(e){console.error("Error submitting feedback:",e),o.oR.error("Failed to submit feedback")}finally{d(!1)}};return(0,s.jsxs)(l.lG,{open:!0,onClose:t,className:"relative z-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsx)(u.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{type:"spring",duration:.3},children:(0,s.jsxs)(l.lG.Panel,{className:"w-full max-w-md rounded-xl bg-gray-900 p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,s.jsx)(l.lG.Title,{className:"text-2xl font-bold text-white",children:"Share Your Feedback"}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-white",children:"✕"})]}),(0,s.jsx)("p",{className:"text-gray-400 mb-4",children:"Help us improve by sharing your thoughts, suggestions, or reporting issues."}),(0,s.jsx)("textarea",{value:a,onChange:e=>n(e.target.value),placeholder:"Enter your feedback here...",className:"w-full h-32 bg-gray-800 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 ring-blue-500 focus:outline-none resize-none mb-4"}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:t,className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),(0,s.jsx)("button",{onClick:x,disabled:r||!a.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-400 disabled:opacity-50",children:r?"Submitting...":"Submit Feedback"})]})]})})})})]})}let ew="force-dynamic";function eC(){let[e,t]=(0,i.useState)(()=>localStorage.getItem("activeTab")||"cook"),{items:a,isLoading:l,error:c,fetchItems:u,addItems:x,updateItem:m}=g(),{duplicateItem:p,isProcessing:h,isEditing:y,handleDuplicateResolution:b,handleEditComplete:j,clearDuplicates:f,handleItems:v}=ei(),{signOut:N}=(0,r.A)(),[w,C]=(0,i.useState)(!1),[k,S]=(0,i.useState)(!1),E=(0,i.useRef)(Date.now()),A=(0,i.useRef)(Date.now()),P=(0,i.useRef)(!1);(0,ey.useRouter)();let{showConfirmation:R,pendingItems:_,receiptImage:F,clearUpload:z}=en(),[q,O]=(0,i.useState)(!1);(0,i.useEffect)(()=>{localStorage.setItem("activeTab",e)},[e]),(0,i.useEffect)(()=>{let e=e=>{let t=document.getElementById("account-menu"),a=document.getElementById("account-button");t&&a&&!t.contains(e.target)&&!a.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,i.useEffect)(()=>{u()},[u]),(0,i.useEffect)(()=>{(0,d.u4)("session_start",{startTime:new Date().toISOString(),initialTab:e});let t=()=>{let t=Math.round((Date.now()-E.current)/1e3);(0,d.u4)("session_end",{duration:t,endTime:new Date().toISOString(),lastActiveTab:e})},a=()=>{document.hidden?(P.current=!0,(0,d.u4)("page_hidden",{timeSpent:Math.round((Date.now()-E.current)/1e3),activeTab:e})):(P.current&&(0,d.u4)("page_visible",{awayTime:Math.round((Date.now()-A.current)/1e3),returnedToTab:e}),P.current=!1,A.current=Date.now())};return window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",a),()=>{window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",a)}},[e]),(0,i.useEffect)(()=>{let t=setInterval(()=>{document.hidden||(0,d.u4)("heartbeat",{activeTab:e,sessionDuration:Math.round((Date.now()-E.current)/1e3),lastInteraction:Math.round((Date.now()-A.current)/1e3)})},3e5);return()=>clearInterval(t)},[e]);let M=async()=>{try{await N()}catch(e){console.error("Error signing out:",e)}},U=a=>{let{uploadState:s}=en.getState();if("idle"!==s){if(!window.confirm("Changing tabs will cancel your receipt upload. Continue?"))return;z()}t(a),localStorage.setItem("activeTab",a),(0,d.u4)("tab_change",{from:e,to:a,uploadState:s})};return(0,s.jsx)(n.q,{children:(0,s.jsxs)("main",{className:"min-h-screen bg-gray-950 text-white",children:[(0,s.jsx)("div",{className:"border-b border-gray-800",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Kitchen Elf"})}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{id:"account-button",onClick:()=>C(!w),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-300 transition-colors text-sm",children:[(0,s.jsx)("span",{children:"\uD83D\uDC64"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Account"})]}),w&&(0,s.jsxs)("div",{id:"account-menu",className:"absolute right-0 mt-2 w-48 bg-gray-900 rounded-lg shadow-lg py-1",children:[(0,s.jsx)(ev(),{href:"/profile",className:"block w-full px-4 py-2 text-left text-gray-300 hover:bg-gray-800 text-sm",onClick:e=>{e.stopPropagation(),C(!1)},children:"Profile Settings"}),(0,s.jsx)(ev(),{href:"/onboarding",className:"block w-full px-4 py-2 text-left text-indigo-400 hover:bg-indigo-950/50 text-sm",onClick:e=>{e.stopPropagation(),C(!1)},children:"Repeat Onboarding"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),M()},className:"w-full px-4 py-2 text-left text-red-400 hover:bg-red-950/50 text-sm border-t border-gray-800",children:"Sign Out"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),C(!1),O(!0)},className:"w-full px-4 py-2 text-left text-gray-300 hover:bg-gray-800 text-sm",children:"Share Feedback"})]})]})})]})})}),(0,s.jsx)("div",{className:"border-b border-gray-800",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("button",{onClick:()=>U("cook"),className:"px-3 py-1.5 ".concat("cook"===e?"border-b-2 border-blue-500 text-blue-500":"text-gray-400 hover:text-gray-200"),children:"Recipe Suggestions"}),(0,s.jsx)("button",{onClick:()=>U("pantry"),className:"px-4 py-3 ".concat("pantry"===e?"border-b-2 border-blue-500 text-blue-500":"text-gray-400 hover:text-gray-200"),children:"Pantry"}),(0,s.jsx)("button",{onClick:()=>U("cookbook"),className:"px-4 py-3 ".concat("cookbook"===e?"border-b-2 border-blue-500 text-blue-500":"text-gray-400 hover:text-gray-200"),children:"Cookbook"})]})})}),(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:"pantry"===e?(0,s.jsx)(er,{}):"cookbook"===e?(0,s.jsx)(eh,{}):(0,s.jsx)(L,{loading:l,pantryItems:a})}),"cook"===e&&(0,s.jsx)(T,{onClick:()=>S(!0),pantryItemsCount:a.length}),c&&(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-4",children:(0,s.jsx)("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded",children:c})}),k&&(0,s.jsx)(D,{onClose:()=>S(!1),pantryItemsCount:a.length}),R&&_&&(0,s.jsx)(ej,{items:_,receiptImage:F,onConfirm:async e=>{try{await v(e,a),en.getState().setShowConfirmation(!1)}catch(e){console.error("Error confirming items:",e),o.oR.error("Failed to add items to pantry"),z()}},onCancel:z}),p&&!y&&(0,s.jsx)(es,{existingItem:p.existing,newItem:p.new,onMergeQuantities:()=>b("merge",x,m),onMergeAndEdit:()=>b("mergeEdit",x,m),onCreateNew:()=>b("create",x,m),onCancel:()=>{f(),z()},isProcessing:h}),y&&p&&(0,s.jsx)(I,{initialValues:{data:{...p.existing.data,quantity:p.existing.data.quantity+p.new.data.quantity},nutrition:p.existing.nutrition},onAdd:async e=>{try{await j(e,m)}catch(e){o.oR.error("Failed to update item"),ei.getState().setIsProcessing(!1)}},onClose:()=>{ei.getState().setIsEditing(!1),ei.getState().setIsProcessing(!1)},isEditing:!0}),q&&(0,s.jsx)(eN,{onClose:()=>O(!1)})]})})}},7916:(e,t,a)=>{"use strict";a.d(t,{q:()=>l});var s=a(5155),i=a(2870),n=a(6046),r=a(2115);function l(e){let{children:t}=e,{user:a,loading:l}=(0,i.A)(),o=(0,n.useRouter)(),c=(0,n.usePathname)();return((0,r.useEffect)(()=>{!l&&(a?["/login","/signup"].includes(c)&&o.push("/home"):["/home","/profile","/settings"].includes(c)&&o.push("/login"))},[a,l,o,c]),l)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):(0,s.jsx)(s.Fragment,{children:t})}},7078:(e,t,a)=>{"use strict";a.d(t,{cq:()=>g,dt:()=>u,gu:()=>m,Hv:()=>x,i$:()=>p});var s=a(1712),i=a(6092),n=a(9250);let r="https://pocketchef-production.up.railway.app",l=e=>e.includes("127.0.0.1")||e.includes("localhost")?e:e.replace("http://","https://"),o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let{data:{session:a}}=await s.N.auth.getSession();if(console.log("Request URL:",e),console.log("Full URL:","".concat(r).concat(e)),console.log("Environment:","production"),!(null==a?void 0:a.access_token))throw console.error("No active session"),new i.U({status:401,message:"No active session"});let o=new Headers({Authorization:"Bearer ".concat(a.access_token),"Content-Type":"application/json"});if(t.headers&&Object.entries(t.headers).forEach(e=>{let[t,a]=e;o.set(t,a)}),n.Ii.isNativePlatform()){console.log("Mobile detected, using Railway"),console.log("Request headers:",Object.fromEntries(o.entries()));let a=await fetch("".concat(r).concat(e),{...t,headers:o});if(console.log("Railway response status:",a.status),!a.ok){let e=await a.text();throw console.error("Railway API Error:",a.status,e),new i.U({status:a.status,message:e||"Request failed"})}return a.json()}let c=await fetch(l("".concat(r).concat(e)),{...t,headers:o,credentials:"include"});if(!c.ok){let e=await c.text();throw console.error("API Error:",c.status,e),new i.U({status:c.status,message:e||"Request failed"})}return c.json()}catch(e){if(console.error("Fetch error:",e),e instanceof i.U)throw e;throw new i.U({status:500,message:"Network error",details:e})}},c=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{return await o(e,t)}catch(s){if(a>0&&s instanceof ApiException&&s.error.status>=500)return await new Promise(e=>setTimeout(e,1e3)),c(e,t,a-1);throw s}},d=async()=>{let{data:{session:e}}=await s.N.auth.getSession();if(!e)throw Error("Not authenticated");return e.access_token},u={async getItems(){let e=await d();return o("/pantry/items",{headers:{Authorization:"Bearer ".concat(e)}})},async addItems(e){let t=await d();return o("/pantry/items",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(e)})},async updateItem(e,t){let a=await d();return o("/pantry/items/".concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify(t)})},async deleteItem(e){let t=await d();return o("/pantry/items/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})},async clearPantry(){let e=await d();return o("/pantry/clear",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})},processReceipt:async e=>{let t=await d();return o("/pantry/receipt/process",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:e})},receipt:{process:async e=>{let t=await d();return o("/pantry/receipt/process",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:e})}}},x={generate:async e=>{let t=await d();return o("/recipes/generate",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(e)})},linkIngredients:async e=>{let t=await d();return o("/recipes/".concat(e,"/link-ingredients"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)}})},getRecipeDetails:async e=>{let t=await d();return o("/recipes/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})},delete:async e=>{let t=await d();return o("/recipes/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})},interact:async(e,t)=>{let a=await d();return o("/recipes/".concat(e,"/interact"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify(t)})},getInteractions:async(e,t)=>{let a=await d();return o("".concat(e?"/recipes/".concat(e,"/interactions"):"/recipes/interactions").concat(t?"?interaction_type=".concat(t):""),{headers:{Authorization:"Bearer ".concat(a)}})},isSaveData:e=>"folder"in e||"notes"in e,saveRecipe:async(e,t)=>{try{return await x.interact(e,{type:"save",data:{folder:t}})}catch(t){if(t instanceof Error&&t.message.includes("duplicate key value")){let t=await x.getInteractions(e,"save");if(t.length>0)return t[0]}throw t}},rateRecipe:async(e,t,a)=>{let s=(await x.getInteractions(e)).find(e=>"rate"===e.type);return s?o("/recipes/".concat(e,"/interactions/").concat(s.id),{method:"PATCH",headers:{Authorization:"Bearer ".concat(await d()),"Content-Type":"application/json"},body:JSON.stringify({type:"rate",data:{rating:t,review:a}})}):x.interact(e,{type:"rate",data:{rating:t,review:a}})},use:async(e,t)=>x.interact(e,{type:"cook",data:t}),getAll:async()=>{let e=await d();return o("/recipes",{headers:{Authorization:"Bearer ".concat(e)}})},getRecipe:async e=>{let t=await d();return o("/recipes/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})},getAllSuggestions:async()=>{let e=await d();return o("/recipes",{headers:{Authorization:"Bearer ".concat(e)}})}},m={async getProfile(){let e=await d();return o("/profile",{headers:{Authorization:"Bearer ".concat(e)}})},async updateProfile(e){let t=await d();return o("/profile",{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(e)})},async createProfile(){let e=await d();return o("/profile",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})}},g={submit:async e=>{let t=await d();return o("/feedback",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({content:e})})}},p={deleteAccount:async()=>{let e=await d();return o("/users/me",{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}}},2870:(e,t,a)=>{"use strict";a.d(t,{A:()=>n,c:()=>i});var s=a(2115);let i=(0,s.createContext)(void 0);function n(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},1712:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});let s=(0,a(5974).UU)("https://sbsieimlilcoejrqhlna.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNic2llaW1saWxjb2VqcnFobG5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM0NjE5NjYsImV4cCI6MjA0OTAzNzk2Nn0.GT2msD-xjfOX6mhNPek7TiDCjIao8ZVvLnJtXoSrdO4",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},db:{schema:"public"}})},6092:(e,t,a)=>{"use strict";a.d(t,{U:()=>s});class s extends Error{constructor(e){super(e.message),this.error=e,this.name="ApiException"}}}},e=>{var t=t=>e(e.s=t);e.O(0,[173,246,466,491,615,441,517,358],()=>t(938)),_N_E=e.O()}]);